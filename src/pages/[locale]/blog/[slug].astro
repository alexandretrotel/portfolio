---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import BlogPostPage from "@/components/pages/blog-post-page.astro";
import type { BlogCollection } from "@/content.config";
import { defaultLocale, locales } from "@/i18n/locales";
import { getBlogEntry } from "@/i18n/utils";

export const getStaticPaths = async () => {
  const paths: {
    params: { slug: string; locale: string };
    props: { post: CollectionEntry<BlogCollection> };
  }[] = [];

  for (const l of locales) {
    if (l === defaultLocale) {
      continue;
    }
    const blogEntry = getBlogEntry(l);
    const posts = await getCollection(blogEntry);
    for (const p of posts) {
      paths.push({
        params: { locale: l, slug: p.id },
        props: { post: p },
      });
    }
  }

  return paths;
};

interface Props {
  post: CollectionEntry<BlogCollection>;
}

const { post } = Astro.props;

export const prerender = true;
---

<BlogPostPage post={post} />
