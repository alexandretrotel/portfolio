---
import { getCollection } from "astro:content";
import DarkModeToggle from "@/components/dark-mode-toggle.svelte";
import LanguageSwitcher from "@/components/language-switcher.astro";
import NavItem from "@/components/nav-item.astro";
import { getTranslations } from "@/i18n/translations";
import { getLocaleFromUrl } from "@/i18n/utils";

type LinkItem = {
  title: string;
  href: string;
  hidden: boolean;
  target?: string;
};

const locale = getLocaleFromUrl(Astro.url);
const t = getTranslations(locale);
const prefix = locale === "en" ? "" : `/${locale}`;

let showBlog = false;
try {
  const collectionName = locale === "fr" ? "blog-fr" : "blog-en";
  const blogPosts = await getCollection(collectionName);
  showBlog = blogPosts.length > 0;
} catch {
  showBlog = false;
}

const links: LinkItem[] = [
  {
    title: t.nav.home,
    href: `${prefix}/`,
    hidden: true,
  },
  {
    title: t.nav.blog,
    href: `${prefix}/blog`,
    hidden: !showBlog,
  },
  {
    title: t.nav.github,
    href: "https://www.github.com/alexandretrotel",
    hidden: false,
    target: "_blank",
  },
];
---

<div
  class="top-0 z-50 h-16 w-full border-border/40 bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60"
>
  <div class="mx-auto flex h-14 max-w-3xl items-center justify-between py-8">
    <a
      class="flex items-center gap-4 transition-transform active:scale-90"
      href={`${prefix}/`}
    >
      <img
        alt="Logo"
        class="rounded-md hover:opacity-80"
        height="32"
        width="32"
        src="/logo.png"
      >
    </a>

    <div class="flex items-center gap-2">
      {links.map((link) => <NavItem link={link} />)}

      <LanguageSwitcher/>

      <div class="transition-transform active:scale-90">
        <DarkModeToggle client:load/>
      </div>
    </div>
  </div>
</div>
