---
import { getCollection } from "astro:content";
import Layout from "@/layouts/main.astro";
import ItemList from "@/components/ui/item-list.astro";

const metadata = {
  description: "Writing on building, networks, and technology.",
  title: "Blog | Alexandre Trotel",
};

const formatDate = (date: Date): string =>
  date.toLocaleDateString("en-US", {
    day: "numeric",
    month: "short",
    year: "numeric",
  });

const posts = await getCollection("blog");

const publishedPosts = posts
  .filter((p) => p.data.published !== false)
  .toSorted((a, b) => b.data.date.getTime() - a.data.date.getTime());

const items = publishedPosts.map((p) => ({
  name: p.data.title,
  summary: formatDate(p.data.date),
  url: `/blog/${p.id}/`,
}));
---

<Layout title={metadata.title} description={metadata.description}>
  <section class="mx-auto flex w-full max-w-3xl flex-col gap-10">
    <header class="space-y-3">
      <h1 class="serif-title text-3xl leading-tight tracking-tight text-foreground md:text-4xl">
        Blog
      </h1>
      <p class="max-w-2xl font-serif text-sm leading-relaxed text-muted-foreground md:text-base">
        My essays and notes.
      </p>
    </header>

    {items.length > 0 ? (
      <ItemList items={items} linkTarget="_self" linkRel="noreferrer" />
    ) : (
      <p class="text-sm text-muted-foreground">No posts yet.</p>
    )}
  </section>
</Layout>
