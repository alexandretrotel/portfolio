---
import type { CollectionEntry } from "astro:content";
import { render } from "astro:content";
import type { BlogCollection } from "@/content.config";
import Layout from "@/layouts/main.astro";

const formatDate = (date: Date): string =>
  date.toLocaleDateString("en-US", {
    day: "numeric",
    month: "short",
    year: "numeric",
  });

interface Props {
  post: CollectionEntry<BlogCollection>;
}

const props = Astro.props as Props;
const post = props.post;
const { Content, remarkPluginFrontmatter } = await render(post);
let minutesRead = "0";
const rawMinutes = remarkPluginFrontmatter?.minutesRead;
if (rawMinutes !== undefined && rawMinutes !== null) {
  if (typeof rawMinutes === "number" && !Number.isNaN(rawMinutes)) {
    minutesRead = String(Math.round(rawMinutes));
  } else if (typeof rawMinutes === "string") {
    const trimmed = rawMinutes.trim();
    minutesRead = trimmed === "" ? "0" : trimmed;
  }
}
---

<Layout
  title={`${post.data.title} | Alexandre Trotel`}
  description={post.data.description}
>
  <article class="mx-auto max-w-3xl">
    <header class="mb-8">
      <p class="text-muted-foreground text-sm">
        {formatDate(post.data.date)}
        {" "}&middot; {minutesRead}
      </p>
    </header>
    <div class="prose prose-gray dark:prose-invert max-w-none"><Content /></div>
  </article>
</Layout>
